# 테스트 구축하기

리팩토링은 분명 가치 있는 도구지만, 이것 만으로는 부족하다. 불가피하게 저지르는 실수를 잡아주는 견고한 테스트 스위트가 뒷받침 돼야 한다. 리팩토링을 하지 않더라도 좋은 테스트를 작성하는 것은 개발 효율을 높일 수 있다.

테스트를 작성은 프로그래밍을 시작하기 전이 가장 좋다. 그 이유는 원하는 기능을 추가하기 위해 무엇이 필요한지 고민하게 되고, 구현보다 인터페이스에 집중하게 된다는 장점도 있다. 또한 코딩이 완료되는 시점을 좀 더 정확하게 판단할 수 있다. 테스트를 모두 통과한 시점이 완료되는 시점이기 때문이다.

## 테스트 샘플 코드

`사용자가 생산 계획을 검토하고 수정하도록 하는 간단한 애플리케이션`

1. `생산 계획`은 각 `지역`의 `수요`와 `가격`으로 구성된다.
2. `지역`에 위치한 `생산자`들은 각기 제품을 특정 `가격`으로 특정 `수량`만큼 생산할 수 있다.
3. 생산자별로 제품을 모두 판매했을 때 얻을 수 있는 `수익`도 보여준다.
4. 생산 `부족분`과 현재 계획에서 거둘 수 있는 `총수익`도 보여준다.
5. 사용자는 수요, 가격, 생산자별 생산량과 비용을 조정해가며, 그에 따른 생산 부족분과 총수익을 확인할 수 있다.

## 첫 번째 테스트

다음은 생산 부족분의 결과값이 제대로 나오는지 확인하는 테스트 코드이다.  
먼저 픽스처(테스트에 필요한 데이터와 객체) 설정을 하고 이 픽스처의 속성들을 검증한다.

```javascript
import Province from '../Province.js'
import { sampleProvinceData } from '../util/data.js'

describe('Province 테스트', () => {
  it('shortfall', () => {
    const korea = new Province(sampleProvinceData()) // 픽스처 설정
    expect(korea.shortfall).toBe(5) // 검증
  })
})
```

테스트를 작성하여 모두 통과 했다는 것은 좋은 일 이지만, 많이 테스트를 하여도 실패하는 케이스가 없다면 그것 나름 불안감을 불러온다. 그래서 각각 케이스 마다 실패하는 모습을 한번씩 직접 확인해 보는 것이 좋다.

`자주 테스트하고, 작성 중인 코드는 최소한 몇 분 간격으로 테스트하자. 적어도 하루에 한 번은 전체 테스트를 돌려보자! (테스트 중 하나라도 실패한다면 리팩터링하면 안 된다. 먼저 테스트가 성공하도록 하자.)`

## 테스트 추가하기

테스트는 위험요인을 중심으로 작성해야 한다.  
테스트의 목적은 어디까지나 현재, 혹은 향후에 발생하는 버그를 찾는 데 있다.  
따라서 단순히 필드를 읽고 쓰기만 하는 접근자는 테스트할 필요가 없다고 생각한다. 그 이유는 이러한 코드는 너무 단순해서 버그가 숨어들 가능성이 별로 없기 때문이다.

테스트를 너무 많이 만들다 보면 오히려 필요한 테스트를 놓치기 쉽다.

`완벽하게 만드느라 테스트를 수행하지 못하느니, 불완전한 테스트라도 작성해 실행하는 게 낫다.`

여러 테스트 케이스마다 공통으로 사용되는 픽스처 들이 있을 텐데, 그럴 경우 `beforeEach`를 사용한다.  
`beforeEach`는 각각의 테스트 바로 전에 실행된다.

```javascript
describe('Province 테스트', () => {
  let korea
  beforeEach(() => {
    korea = new Province(sampleProvinceData()) // 픽스처 설정
  })

  it('shortfall', () => {
    expect(korea.shortfall).toBe(5) // 검증
  })

  it('profit', () => {
    expect(korea.profit).toBe(230) // 검증
  })
})
```

`beforeEach`구문 밖에 픽스처 변수를 뺀 이유는 테스트 끼리 상효작용하게 하는 공유 픽스처를 생성하지 않기 위함이다. 만약 이렇게 하지 않으면 다른 테스트에서 이 공유 객체의 값을 수정할 경우 이 픽스처를 사용하는 또 다른 테스트가 실패할 수 있기 때문이다.

## 경계 조건 검사하기

현재 까지 작성한 테스트 코드는 모든 일이 순조롭고 사용자도 개발자의 의도대로 사용하는 상황에 집중하였다. 하지만 이 범위를 벗어나는 경계 지점에서 문제가 생기면 어떤 일이 일어나는지 확인하는 테스트도 작성하는 것이 좋다.

`문제가 생길 가능성이 있는 경계 조건을 생각해보고 그 부분을 집중적으로 테스트하자.`
